
<!-- README.md is generated from README.Rmd. Please edit that file -->

# multimod <img src="man/figures/logo.png" align="right" height="130"/>

<!-- badges: start -->

[![Lifecycle:
experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![CRAN
status](https://www.r-pkg.org/badges/version/multimod)](https://CRAN.R-project.org/package=multimod)
[![Contributor
Covenant](https://img.shields.io/badge/Contributor%20Covenant-2.1-4baaaa.svg)](code_of_conduct.md)
<!-- badges: end -->

The `multimod` R package defines a domain-specific language (DSL) and
internal representation for mathematical programming models. It enables
parsing, manipulation, and export of equations and constraints across
multiple modeling languages including GAMS, Pyomo, JuMP, and LaTeX.

## Installation

``` r
# install.packages("pak")
pak::pak("optimal2050/multimod")
```

## Core Features

- Parse GAMS-style equations into symbolic tree structure
- Represent variables, parameters, and mappings as structured R objects
- Render equations to multiple target formats: GAMS, Pyomo, JuMP, LaTeX
- Visualize equations as graphs (visNetwork or DiagrammeR)

## Workflow Diagram

Items in curly braces `{}` are planned for implementation, double curly
braces `{{}}` are potential extensions.

``` text
[ GAMS / {JuMP / Pyomo / GMPL} ]
              ↓
          read_gams()
         {read_jump()}
         {read_pyomo()}
         {read_gmpl()}
           {{...}}
              ↓
     ┌────────────────────┐
     │  model_structure   │
     │ (a named list ...) │
     └────────────────────┘
              ↓
        as_multimod()
              ↓
   ┌────────────────────────┐
   │    Core Structures     │      as_visNetwork() 
   │    <ast>, <multimod>   │     {as_diagrammer()} 
   │ (sets, parameters,     │ ⟷  {{symbolsic manipulation}}  
   │  variables, equations, │     {fold_parameters(), ...}
   │  mappings, ...)        │     {data exchange}
   └────────────────────────┘
              ↓
     ┌────────────────────┐
     │ Rendering / Output │
     └────────────────────┘
              ↓
   → write_latex()
   → write_gams()
   → {write_jump()}
   → {write_pyomo()}
   → {write_gmpl()}
   → {{write_ampl()}}
   → {{write_mps()}}
   → {{write_cplex()}}
   → {{write_gurobi()}}
   → {{...}}
```

## Example Workflow

Load a GAMS model and parse

``` r
library(multimod)
model_info <- read_gams("my_model.gms")
class(model_info) # "model_structure"
```

``` r
mod <- as_multimod(model_info, name = "My model in multimod format")
class(mod) # "model"    "multimod"
```

    #> [1] "model"    "multimod"

AST elements: an example equation

``` r
eq <- mod$equations[["eqObjective"]]
print(eq)
#> <AST equation> eqObjective
#>   relation:  == 
#>   lhs:  vObjective 
#>   rhs:  sum(if (mvTotalCost[region,year]) {[region,year]}v...
```

Render an equation to LaTeX

``` r
as_latex(eq) |> cat()
```

$$
\textit{vObjective} = \sum_{{r,y} \in \textsf{mvTotalCost}_{r,y}} {\textit{vTotalCost}_{r,y}  \cdot  \textsf{pPeriodLen}_{y}  \cdot  \textsf{pDiscountFactor}_{r,y}}
$$

Render a specific equation to GAMS or Julia/JuMP

``` r
as_gams(eq) |> cat()
#> eqObjective..
#>   vObjective =e=
#>   sum(([region,year])$mvTotalCost[region,year], vTotalCost[region,year] * pPeriodLen[year] * pDiscountFactor[region,year]);
# {as_jump(mod$equations[["eqObjective"]])}
```

Visualize equation tree

``` r
library(visNetwork)
as_visNetwork(eq)
```

Write the entire model to LaTeX

``` r
write_latex(mod, 
            file = "my_multimod_model.tex",
            title = "My multimod model equations",
            subtitle = "Generated by multimod package")
tinytex::pdflatex("my_multimod_model.tex")
```

Save to GAMS

``` r
write_gams(mod, file = "my_multimod_model.gms")
```

## License

MIT License

## Development Status

The package is under active development. Contributions, bug reports, and
feature requests are welcome! See details in
[{devstatus}](articles/roadmap.html).
