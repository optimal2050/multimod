---
output:
  github_document:
    # pandoc_args: --webtex
  header-includes:
    - \usepackage{amsmath}
    - \usepackage{amssymb}
    # - \usepackage{breqn}
    # - \usepackage{graphicx}
    # - \usepackage{bm}
    # - \usepackage[mathcal]{eucal}
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# multimod [<img src="man/figures/logo.png" align="right" height="130"/>](https://optimal2050.github.io/multimod/)

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![CRAN status](https://www.r-pkg.org/badges/version/multimod)](https://CRAN.R-project.org/package=multimod)
 [![Contributor Covenant](https://img.shields.io/badge/Contributor%20Covenant-2.1-4baaaa.svg)](code_of_conduct.md)
<!-- badges: end -->

The `multimod` R package is an effort to bridge alternative mathematical modeling frameworks and languages, particularly those used in energy system modeling. It defines a domain-specific language (DSL) for representing mathematical programming models in a unified, abstract format.

`multimod` supports partial parsing of models written in GAMS (General Algebraic Modeling System), and is being extended to support more GAMS language features, as well as JuMP (Julia), Pyomo (Python), and GMPL (GNU Math Programming Language). Parsed models can be converted into the `multimod` format for analysis, manipulation, visualization, or rendering to LaTeX and other modeling languages.

The package is designed to facilitate the exchange of mathematical models across different languages and solver frameworks, with the goal of simplifying the development, comparison, and reuse of complex optimization models in energy systems and beyond.

## Development Status
The package is under active development. Contributions, bug reports, and feature requests are welcome! See [Get started](articles/multimod.html) for an overview of the current functionality and [{devstatus}](articles/roadmap.html) for the roadmap.

## Workflow Diagram
Items in curly braces `{}` are planned for implementation, 
double curly braces `{{}}` are potential extensions.

```text
[ GAMS / {JuMP / Pyomo / GMPL} ]
              ↓
          read_gams()
         {read_jump()}
         {read_pyomo()}
         {read_gmpl()}
           {{...}}
              ↓
     ┌────────────────────┐
     │  model_structure   │
     │ (a named list ...) │
     └────────────────────┘
              ↓
        as_multimod()
              ↓
   ┌────────────────────────┐
   │    Core Structures     │      as_visNetwork() 
   │    <ast>, <multimod>   │     {as_diagrammer()} 
   │ (sets, parameters,     │ ⟷  {{symbolsic manipulation}}  
   │  variables, equations, │     {fold_parameters(), ...}
   │  mappings, ...)        │     {data exchange}
   └────────────────────────┘
              ↓
     ┌────────────────────┐
     │ Rendering / Output │
     └────────────────────┘
              ↓
   → write_latex()
   → write_gams()
   → {write_jump()}
   → {write_pyomo()}
   → {write_gmpl()}
   → {{write_ampl()}}
   → {{write_mps()}}
   → {{write_cplex()}}
   → {{write_gurobi()}}
   → {{...}}

```

## Installation and Example Workflow

``` r
# install.packages("pak")
pak::pak("optimal2050/multimod")
```

### Load a GAMS model and parse
```r
library(multimod)
model_info <- read_gams("my_model.gms")
class(model_info) # "model_structure"
```
```{r, include=TRUE, echo=FALSE, warning=FALSE, message=FALSE}
library(multimod)
mod <- multimod::example_model$multimod
# class(mod) # "model_structure"
```

```r
mod <- as_multimod(model_info, name = "My model in multimod format")
class(mod) # "model"    "multimod"
```

```{r, echo=FALSE}
class(mod)
```

#### AST elements: an example equation
```{r}
eq <- mod$equations[["eqObjective"]]
print(eq)
```

#### Render an equation to LaTeX
```{r, eval=TRUE, results='asis'}
as_latex(eq) |> cat()
```
$$
\textit{vObjective} = \sum_{{r,y} \in \textsf{mvTotalCost}_{r,y}} {\textit{vTotalCost}_{r,y}  \cdot  \textsf{pPeriodLen}_{y}  \cdot  \textsf{pDiscountFactor}_{r,y}}
$$

#### Render a specific equation to GAMS or Julia/JuMP
```{r}
as_gams(eq) |> cat()
# {as_jump(mod$equations[["eqObjective"]])}
```

#### Visualize equation tree
```{r, eval=FALSE}
library(visNetwork)
as_visNetwork(eq)
```

#### Write the entire model to LaTeX
```r
write_latex(mod, 
            file = "my_multimod_model.tex",
            title = "My multimod model equations",
            subtitle = "Generated by multimod package")
tinytex::pdflatex("my_multimod_model.tex")
```
#### Write GAMS model
```r
write_gams(mod, file = "my_multimod_model.gms")
```

## License

MIT License




